# Framingham heart data


We use simulation to investigate the relationship between serum
cholesterol and heart attacks in the Framingham data.

Before come to the simulation, we need some new code to tune our
histograms (see <a href="#sec-on-histograms" class="quarto-xref"><span
class="quarto-unresolved-ref">sec-on-histograms</span></a>). We are
going to set the bins for the histogram using advanced ranges.

### 21.2.8 Advanced ranges

So far (<a href="#sec-ranges" class="quarto-xref"><span
class="quarto-unresolved-ref">sec-ranges</span></a>) we have used the
colon syntax to make regular sequences of integers. For example, to make
a vector of the sequential integers from 3 through 12, we could use:

```{r}
3:12
```

R also has a function `seq` that makes sequences. In practice we would
likely use the colon syntax for the problem above, but we could also use
`seq`, like this:

```{r}
seq(3, 12)
```

The first argument is the starting value, and the second is the stopping
value. The result is all the sequential integers, up to and including
the stopping value.

Sometimes we want to be able to specify a step size — the gap between
the numbers in the sequence. In the sequence above, the gap (step)
between each number is 1. We might want some other step size. To create
a sequence of integers from 3 through 33 in steps of 5, we could write:

```{r}
seq(3, 33, by=5)
```

Read this as “give me the sequence (range) of numbers, starting at 3, up
to and including 33, in steps(`by`) of 5.

So far we have used integers as the start, stop and step(`by`) values,
but we could also use floating point values. For example, to get a
sequence of values starting at 0.1 up to and including 0.9, in steps of
0.2:

```{r}
seq(0.1, 0.9, by=0.2)
```

### 21.2.9 Simulation for infarction and cholesterol

With that background, we can proceed with the simulation.

```{r}
n <- 10000

men <- rep(c('infarction', 'no infarction'), c(31, 574))

n_high <- 135  # Number of men with high cholesterol
n_low <- 470  # Number of men with low cholesterol

infarct_differences <- numeric(n)

for (i in 1:n) {
    highs <- sample(men, size=n_high, replace=TRUE)
    lows <- sample(men, size=n_low, replace=TRUE)
    high_infarcts <- sum(highs == 'infarction')
    low_infarcts <- sum(lows == 'infarction')
    high_prop <- high_infarcts / n_high
    low_prop <- low_infarcts / n_low
    infarct_differences[i] <- high_prop - low_prop
}

# Set the histogram bin edges to the sequence starting at -0.1, up to
# (including) 0.1, in steps of 0.005.
hist(infarct_differences, breaks=seq(-0.1, 0.1, by=0.005),
     main='Infarct proportion differences in null universe')

# How often was the resampled difference >= the observed difference?
k <- sum(infarct_differences >= 0.029)
# Convert this result to a proportion
kk <- k / n

message('Proportion of trials with difference >= observed: ',
        round(kk, 2))
```

The results of the test using this program may be seen in the histogram.
We find — perhaps surprisingly — that a difference as large as observed
would occur by chance around 10 percent of the time. (If we were not
guided by the theoretical expectation that high serum cholesterol
produces heart disease, we might include the 10 percent difference going
in the other direction, giving a 20 percent chance). Even a ten percent
chance is sufficient to call into question the conclusion that high
serum cholesterol is dangerous. At a minimum, this statistical result
should call for more research before taking any strong action clinically
or otherwise.
